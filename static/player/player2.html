<!DOCTYPE html>
	<head>
		<title>mDVD Player II</title>
		<style>
			body {
				font-family: sans-serif;
			}
			.hudstyle{
				position:relative;
				width:360px;
				height:100%;
				top:0;
				background-color:white;
				color:black;
				opacity:0.5;
				z-index:2;
				overflow:scroll;
				-webkit-transition: 1s;
				-moz-transition: 1s;
				-ms-transition: 1s;
				-o-transition: 1s;
				transition: 1s;
				left: 720px !important;
			}
			.hudstyle.showhud {
			  -webkit-transition: .5s;
			  -moz-transition: .5s;
			  -ms-transition: .5s;
			  -o-transition: .5s;
			  transition: .5s;
			  left: 360px !important;
			}
			.chapterListStyle{
				-webkit-transition: 1s;
				-moz-transition: 1s;
				-ms-transition: 1s;
				-o-transition: 1s;
				transition: 1s;
				height:0;
				overflow:hidden;
			}
			.chapterListStyle.showChapter{
				-webkit-transition: 1s;
				-moz-transition: 1s;
				-ms-transition: 1s;
				-o-transition: 1s;
				transition: 1s;
				height:400px;
				overflow:scroll;
			}
			
		</style>
	</head>
	<body>
		<div id="viewer" style="width:720px;height:480px;background-color:black;overflow:hidden;">
			
			<div id="hud" class="hudstyle">
				<ul id="transportControls">
					<li id="resumeButton" >resume</li>
					<li id="exitButton">exit</li>
				</ul>
				<ol id="titleList">
					<!--
					<li id="title1Button">Title 1
						<ol id="title1Chapters" class="chapterListStyle">
							<li>Chapter 1</li>
							<li>Chapter 2</li>
							<li>Chapter 3</li>
							<li>Chapter 4</li>
							<li>Chapter 5</li>
							<li>Chapter 6</li>
							<li>Chapter 7</li>
							<li>Chapter 8</li>
							<li>Chapter 9</li>
							<li>Chapter 10</li>
							<li>Chapter 12</li>
							<li>Chapter 13</li>
							<li>Chapter 14</li>
							<li>Chapter 15</li>
							<li>Chapter 16</li>
						</ol>
					</li>
					<li id="title2">Title 2
						<ol id="title2_chapters" class="chapterListStyle">
							<li>Chapter 1</li>
							<li>Chapter 2</li>
						</ol>
					</li>
					<li id="title3">Title 3
						<ol id="title3_chapters" class="chapterListStyle">
							<li>Chapter 1</li>
							<li>Chapter 2</li>
						</ol>
					</li>
					-->
				</ol>
			</div>
			
			<video id="dvdstream" style="z-index:1;"></video>
			
		</div>
		
		<script>
		
			// init ui controls
			var viewer = document.getElementById('viewer');
			var hud = document.getElementById('hud');
			var resumeButton = document.getElementById('resumeButton');
			var exitButton = document.getElementById('exitButton');
			var titleList = document.getElementById('titleList');
			var dvdstream = document.getElementById('dvdstream');
			
			// wire-up events
			viewer.onclick = function(){
				
				// debug
				console.log('viewer click');
				
				toggleHud();
			}
			
			resumeButton.onclick = function(){
				
				// debug
				console.log('resumeButton click');
				
			}
			
			exitButton.onclick = function(){
				
				// debug
				console.log('exitButton click');
				
			}
			
			// todo: this is hard-wired for debugging, but will
			// be dynamically assigned when lists are created
			// on-the-fly
			/*
			var title1Button = document.getElementById('title1Button');
			var title1Chapters = document.getElementById('title1Chapters');
			title1Button.onclick = function(e){
				
				// debug
				console.log('title1Button click');
				
				e.stopPropagation();
				
				title1Chapters.classList.add('showChapter');
			}
			*/
			
			// todo: load & play video
			
			// load title list
			loadTitles();
			
			// utility functions
			function toggleHud(){
				
				if(!hud.classList.contains('showhud')){
					//dvdstream.pause();
					hud.classList.add('showhud');
				} else {
					//dvdstream.play();
					hud.classList.remove('showhud');
				}
			}
			
			function showChapters(title){
				
				// todo: figure out how to capture the event that
				// got us here so we can stop it from bubbling
				
				var chapterList = document.getElementById('title' + title + 'Chapters');
				
				chapterList.classList.add('showChapter');
			}
			
			function loadTitles(){

				var titleReq = new XMLHttpRequest();

				titleReq.onreadystatechange = titleRes;
				titleReq.open('GET', '/titles', true);
				titleReq.send();

				function titleRes(){
					if(this.readyState === 4){
						if(this.status === 200){

							var titles = JSON.parse(this.responseText);

							// add titles
							for(var i=0;i<titles.length;i++){
								
								var title = titles[i];
								
								var titleName = 'Title ' + title.title;
								
								var titleListItem = document.createElement('li');
								titleListItem.setAttribute('onclick', 'showChapters(\'' + title.title + '\')');
								
								// add chapters
								var chapterList = document.createElement('ol');
								chapterList.setAttribute('id', 'title' + title.title + 'Chapters');
								chapterList.setAttribute('class', 'chapterListStyle');
								
								var chapters = titles[i].chapters;

								for(var j=0;j<chapters.length;j++){
									
									var chapter = chapters[j];
	
									var chapterName = 'Chapter ' +  chapter.chapter;
	
									// add chapters to chapter list
									var chapterListItem = document.createElement('li');
									chapterListItem.setAttribute('onclick', 'playChapter(\'' + title.title + '\',\'' + chapter.chapter + '\')');
									chapterListItem.innerHTML = chapterName;
									chapterList.appendChild(chapterListItem);
								}
								
								titleListItem.innerHTML = titleName;
								titleListItem.appendChild(chapterList);
								titleList.appendChild(titleListItem);
							}
						}
					}
				}
			}
			
			function playChapter(title, chapter){

				// debug
				console.log('requesting title: ' + title + ', chapter: ' + chapter);

				// play the selected chapter
				var playChapterReq = new XMLHttpRequest();
				playChapterReq.onreadystatechange = playChapterRes;
				playChapterReq.open('GET', '/play/1/' + chapter + '/1', true);
				playChapterReq.send();

				function playChapterRes(){
					if(this.readyState === 4){
						if(this.status === 200){
							console.log('playing requested chapter');

							// todo: it may be necissary to re-initialize the client
							// side of the playback viewer
							dvdstream.load();
							dvdstream.play();

						} else {
							console.log('error requesting chapter');
						}
					}
				}
			}
			
		</script>
		
	</body>
</html>